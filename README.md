# HL2-ResearchMode
Hololens2 app to get raw sensor data from ResearchMode API plugin and stream to Ros

# Get started
This tutorials below will show you how to deploy the Unity sample app to HL2 device.

## What you need
1. Visual Studio with Unity supported.
2. Unity 2019.4.2f1 in Windows system with UWP supported.
3. Ros melodic in ubuntu system as a server.
* More details about Installing tools for Hololens2 can be found at [this Microsoft official document.](https://docs.microsoft.com/en-us/windows/mixed-reality/develop/install-the-tools?tabs=unity)

## Deploy app to Hololens2 device
1. Open the project. Choose `Assets/Scenes/SampleScene.unity` to the scene.
2. You can change server IP address  in `RosSharp/RosConnector.cs` in the inspector. 
2. Build the Unity project. The output is a Visual Studio Solution (which you will then have to also build).
3. **Add new package and capability to `Package.appxmanifest` file in the VS2019 solution.** [Check the Microsoft official sample](https://github.com/microsoft/HoloLens2ForCV/blob/main/Samples/SensorVisualization/SensorVisualization/Package.appxmanifest) and add `Capability` and `Package` to your own file.  
4. Open the VS2019 solution generated by Unity. Follow [releted Microsoft doc](https://docs.microsoft.com/en-us/windows/mixed-reality/develop/platform-capabilities-and-apis/using-visual-studio) to use USB-C cable to connect the HL2 device to PC, or use wifi. Set "ARM64" and "release" to deploy the app to HL2 device. 

## Stream sensor data to Ros
1. Load Ros package to ubuntu system. Make sure IP address of ubuntu is the same as what you set in Unity project
2. Lauch `roslaunch file_server ros_sharp_communication.launch`.
3. After server is running, then open your HL2 application. Now you might be able to find the Ros topics in ubuntu.

# Build plugin from source
1. Open plugin project using VS2019.
2. Make sure settings are set as `release` and `arm64`. Build the project.
3. Copy all output files to Unity project `'HL2-ResearchMode-Unity\Assets\ResearchMode\Plugins\ARM64'`. Make sure the platform is `WSAPlayer`, SDK is `UWP` and CPU is `ARM64` or `any CPU` .
* This plugin is a UWP windows runtime component pulgin, it only works in Hololens2 device. There is no way to use it in Unity Editor directly.

# Attention
1. If you are building the Unity project yourself, make sure to check the following setting.(If you are build your own project)
   * Build platform is Universal Windows Platform.
   * Target and platform are set to `Hololens` and `ARM64`.
   * Windows Mixed Reality XR setting(not plugin) is activated in Player settings.
   * more details can be found at [related Microsoft doc.](https://docs.microsoft.com/en-us/windows/mixed-reality/develop/unity/configure-unity-project)
2. Be sure to add new package and capability to `Package.appxmanifest` file.

# Content
There are 3 major parts in this project.
* HL2-ResearchMode-Plugin. This is the Visual Studio project for the Research Mode plugin. You can build from source using this project.
* HL2-ResearchMode-Unity. Unity application project for Hololens2 device.
* Ros. Ros package as a server to receive messages published by HL2.

# Dependencies and reference
* [HoloLens2ForCV](https://github.com/microsoft/HoloLens2ForCV). Native C++ HL2 research mode API by Microsoft.
* [HoloLens2-ResearchMode-Unity](https://github.com/petergu684/HoloLens2-ResearchMode-Unity). 
* [HoloLensCameraStream](https://github.com/VulcanTechnologies/HoloLensCameraStream). The plugin that get the access to RGB camera video stream.
* [MRTK](https://github.com/microsoft/MixedRealityToolkit-Unity)

